# Задача 1

---

## Позитивный сценарий

| ID | Название | Предусловия | Шаги | Ожидаемый результат |
|----|----------|-------------|------|-------------------|
| 1 | Успешная оплата валидной картой | Пользователь авторизован, в корзине есть товары, доступны тестовые данные карты | 1. Перейти на страницу оплаты<br>2. Ввести валидные данные карты (номер, срок, CVV)<br>3. Нажать «Оплатить»<br>4. Пройти 3-D Secure при редиректе<br>5. Дождаться ответа шлюза | Статус заказа изменён на «Оплачен», отображено сообщение об успехе, на email отправлен чек |

---

## Негативные сценарии

| ID | Название | Предусловия | Шаги | Ожидаемый результат |
|----|----------|-------------|------|-------------------|
| 2 | Оплата отклонена банком | На стороне банка настроен отказ по тестовой карте | 1. Ввести данные карты, которая будет отклонена<br>2. Нажать «Оплатить»<br>3. Пройти 3-D Secure при наличии | Статус заказа «Отклонено», сообщение «Платёж отклонён банком», чек не отправлен |
| 3 | Ошибка платёжного шлюза | Шлюз возвращает 5xx-ошибку | 1. Ввести валидные данные карты<br>2. Нажать «Оплатить»<br>3. Имитировать ошибку шлюза | Сообщение «Ошибка платёжного сервиса», статус заказа «Ошибка оплаты», доступна повторная попытка |
| 4 | Таймаут при взаимодействии со шлюзом | Настроен таймаут соединения | 1. Инициировать оплату<br>2. Имитировать задержку ответа шлюза > таймаута | Сообщение «Превышено время ожидания», статус заказа «Ожидает оплаты», доступна повторная отправка |

---

## Проверка валидации (клиентская)

| ID | Название | Предусловия | Шаги | Ожидаемый результат |
|----|----------|-------------|------|-------------------|
| 5 | Неверный формат номера карты | Форма оплаты открыта | 1. Ввести номер карты < 16 цифр<br>2. Нажать «Оплатить» | Сообщение «Неверный номер карты», отправка заблокирована |
| 6 | Истёкший срок действия карты | Форма оплаты открыта | 1. Ввести месяц/год в прошлом<br>2. Нажать «Оплатить» | Сообщение «Срок действия карты истёк», отправка заблокирована |
| 7 | Неверный CVV | Форма оплаты открыта | 1. Ввести CVV из 2 цифр для Visa/MC<br>2. Нажать «Оплатить» | Сообщение «Неверный CVV», отправка заблокирована |
| 8 | Пустые обязательные поля | Форма оплаты открыта | 1. Оставить поля пустыми<br>2. Нажать «Оплатить» | Подсветка ошибок для всех пустых полей, отправка заблокирована |

---

## Граничные значения

| ID | Название | Предусловия | Шаги | Ожидаемый результат |
|----|----------|-------------|------|-------------------|
| 9 | Номер карты ровно 16 цифр | Форма оплаты открыта | 1. Ввести 16-значный номер валидного формата<br>2. Пройти валидацию | Валидация пройдена, переход к оплате |
| 10 | Номер карты 19 цифр (макс. для некоторых карт) | Форма оплаты открыта | 1. Ввести 19-значный номер<br>2. Пройти валидацию | Принято, если формат поддерживается, иначе понятная ошибка |
| 11 | CVV ровно 3 цифры (Visa/MC) | Форма оплаты открыта | 1. Ввести CVV из 3 цифр<br>2. Пройти валидацию | Валидация пройдена |
| 12 | Срок действия: текущий месяц/год | Форма оплаты открыта | 1. Ввести текущий месяц и год<br>2. Пройти валидацию | Карта принята как валидная |
| 13 | Срок действия: следующий месяц | Форма оплаты открыта | 1. Ввести месяц+1 от текущего<br>2. Пройти валидацию | Карта принята как валидная |

---

## Интеграция с платёжным шлюзом

| ID | Название | Предусловия | Шаги | Ожидаемый результат |
|----|----------|-------------|------|-------------------|
| 14 | Успешный проход 3-D Secure | Карта требует 3DS-аутентификации | 1. Ввести данные карты с 3DS<br>2. Нажать «Оплатить»<br>3. Успешно пройти аутентификацию<br>4. Вернуться на сайт | Платёж успешен, статус заказа обновлён, чек отправлен |
| 15 | Неудачная 3-D Secure аутентификация | Карта требует 3DS | 1. Ввести данные карты с 3DS<br>2. Отклонить аутентификацию на странице банка | Платёж отклонён, сообщение «Аутентификация не пройдена», заказ не оплачен |
| 16 | Чек отправляется только при успехе | Настроен email-сервис | 1. Выполнить успешную оплату<br>2. Проверить почту<br>3. Выполнить неудачную оплату<br>4. Проверить почту | Чек получен только после успешной оплаты |
| 17 | Корректная обработка webhook от шлюза | Настроен endpoint для callback | 1. Инициировать оплату<br>2. Отправить тестовый webhook со статусом «success» | Статус заказа обновлён без участия UI, пользователь уведомлён |